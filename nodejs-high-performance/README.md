# Node.js High Performance

by Diogo Resende

# Ch. 01 소개 및 컴포지션

- 성능을 높이는 일은 많은 요소들과 연결돼 매우 어렵다.
- 사용하는 언어의 단점을 알고 있을 때, 최선의 성과를 만들어낼 수 있다.
- JS 는 네트워크나 디스크에 접속할 방법이 없다. 대신, Node.js 는 libuv 를 사용해 논블로킹 I/O 모델을 통해 제공한다. 이 I/O 모델의 API 에는 버퍼와 스트림이 존재한다.
  - 버퍼: 이진 데이터 형식을 JSON 같은 다른 형식으로 전환할 때 유용하다.
  - 스트림: 네트워크 모델과 유사한 모듈이다. readable, writable, duplex, 그리고 transform 스트림을 생성할 수 있는 기본 클래스에 접근할 수 있다.

## 성능 분석 (프로파일링)

- 성능이란 정해진 기간과 리소스에서 수행이 완료되는 일의 양을 의미한다.
- 성능 분석을 위해 성능 목표에 따라 여러가지 측정 기준 (메트릭)을 사용할 수 있다.
- Node.js 의 우수성은 I/O 작업에 의해 애플리케이션이 블로킹되지 않는다는 점이다.

## 모니터링

- 모니터링을 통해 플랫폼이 동작을 멈추거나 다음에 동작을 멈출 위치를 알 수 있다.

## 고성능 확보

- 고성능은 개발 계획에서부터 시작된다.
- 사용자 수의 증가는 분산 아키텍처의 필요성을 높이거나, 최소한 다수의 인스턴스를 통해 부하를 분산시킬 것을 요구한다.
- 대부분의 애플리케이션은 시간이 지날수록 그 성능(처리 능력)이 떨어진다. 이는 데이터베이스와 디스크의 데이터 크기가 증가하기 때문이다.
- 지리적으로 분산된 서버들은 클라이언트로부터 더 가까운 곳에서 동작해 더 좋은 성능을 제공할 수 있다.

## 테스트와 벤치마킹

- 애플리케이션이 특정 환경에서 정상적으로 동작하는지 확인하는 방법이다.
- 성능을 분석하면 애플리케이션의 병목 구간을 탐지할 수 있다.
- 대표적인 예시로
  - [benchmarkjs](http://benchmarkjs.com)
  - [ben](https://github.com/substack/node-ben)
- 부하 테스트는 가장 단순한 형태의 벤치마킹이다.
  - 특정 부하에서 애플리케이션의 성능이 어느정도인지 확인할 수 있다.
  - 애플리케이션에서 1초에 받아들일 수 있는 연결의 수나 처리할 수 있는 트래픽의 바이트 수를 확인할 수 있다.
- 유지(Soak) 테스트는 애플리케이션의 성능이 유지되는 시간을 확인하기 위해 수행된다.
  - 이 테스트는 시간이 지나면서 성능이 저하되는 애플리케이션의 반응성을 분석할 때 필요하다.
  - 시간이 지나면서 메모리 누수에 따른 성능 저하가 발생하는 애플리케이션의 메모리 누수를 확인하는 데 유용하게 사용된다.
- 스파이크 테스트는 부하가 갑자기 증가하는 상황에서 애플리케이션의 반응과 성능을 확인하기 위해 수행된다.

## 애플리케이션 컴포지션

- 컴포지션은 애플리케이션의 유지, 보수, 개발, 이해가 용이하게 애플리케이션을 작은 단위로 나누는 방식을 말한다.
- 코드 나누기
  - 코드는 항상 작은 단위로 나눠야 한다.
  - 5KB 보다 큰 파일은 나누기를 고려애햐 한다.
- 함수 규칙 사용
  - [JSCS](http://jscs.info) 참조
  - 콜백으로 사용되는 클로저 함수인 경우 반드시 함수명을 명시해야 한다.
    - 이를 통해 코드가 실행 중 멈춰도 스택을 추적하는 과정에서 이를 구분할 수 있다.
    - 또한 새로운 개발자가 함수의 목적을 빨리 이해하는 데 도움이 된다.
  - 조건 분기를 중첩해 사용하지 말고, 반환은 가능한 빠르게 한다.
  - 함수를 작고 단순하게 작성하자.
